!function(){"use strict";function e(t){function n(){++s===a.streams.length&&(a.ready=!0,a.next(150))}var a=this,s=0;this.element=document.querySelector(t.element)||document.createElement("div"),this.messages=document.createElement("div"),this.messages.className="messages";var r=document.createElement("a");r.href="#",r.innerHTML="Load more",r.onclick=function(){return a.next(150),!1},this.element.appendChild(this.messages),this.element.appendChild(r),this.ready=!1,this.streams=[],t.streams.forEach(function(t){if("undefined"!=typeof e.Stream.source[t.type]){var s=new e.Stream(t);s.ready=n,a.streams.push(s)}}),function i(){function e(e){if(t.push(e.reverse()),s+=e.length,++n===a.streams.length){for(var r,i=0;s>i;i++){r=t[0];for(var o=1;o<t.length;o++)(!r.length||t[o].length&&r[0].date<t[o][0].date)&&(r=t[o]);r.length&&a.display(r.shift(),!0)}a.updateTime()}}if(setTimeout(i,12e4),a.ready){var t=[],n=0,s=0;a.streams.forEach(function(t){t.poll(e)})}}()}var t=e.helpers={parseTime:function(e){return e=new Date(e).valueOf().toString(),parseInt(e.substr(0,e.length-3),10)},fuzzyTime:function(e){var t=Math.floor((Date.now()-1e3*e)/1e3);return 2>t?"just now":60>t?t+"s ago":3600>t?Math.ceil(t/60)+"m ago":82800>t?Math.ceil(t/60/60)+"h ago":518400>t?Math.ceil(t/60/60/24)+"d ago":Math.ceil(t/60/60/24/7)+"w ago"},template:function(e,t){return e.toString().replace(/{(\w+)}/g,function(e,n){return t[n]})},toArray:function(e){return[].slice.apply(e)},copy:function(e,t){Object.keys(t).forEach(function(n){var a=t[n];"object"==typeof a&&(a=new a.constructor(a)),e["fill"===n?"_fill":n]=a})}};e.prototype.updateTime=function(){[].forEach.call(this.messages.children,function(e){e.firstChild.innerHTML=t.fuzzyTime(e.getAttribute("data-timestamp"))})},e.prototype.display=function(n,a){var s=document.createElement("div"),r=document.createElement("span"),i=document.createElement("span"),o=document.createElement("i"),c=n.type.toLowerCase().replace(/\W/g,"-");if(s.className="message message-"+c,s.setAttribute("data-timestamp",n.date),o.className="fa fa-"+e.Stream.source[n.type].icon,r.className="message-body",r.innerHTML=" "+n.message,i.className="message-date",i.innerHTML=t.fuzzyTime(n.date),n.link&&s.setAttribute("data-link",n.link),s.onclick=function(e){"A"!==e.target.tagName&&n.link&&window.open(n.link)},s.appendChild(i),s.appendChild(o),s.appendChild(r),!a)return this.messages.appendChild(s);for(var m=this.messages.children,l=m.length,u=0;l>u&&+m[u].getAttribute("data-timestamp")>n.date;u++);this.messages.insertBefore(s,m[u])},e.prototype.next=function(e,t){var n=this.streams[0],a=this.streams.length;t=t||0;for(var s=1;a>s;s++)this.streams[s].current()>n.current()&&(n=this.streams[s]);if(!(n.empty()||++t>e)){var r=this;n.shift(function(n){r.display(n),r.next(e,t)})}},window.Zenosphere=e}();
!function(){"use strict";function t(s){e.copy(this,t.source[s.type]),this.vars={},e.copy(this.vars,s),this.buffer=[],this.results={max:0,min:0},this.options.paginate&&(this.vars.page=0);var i=this;setTimeout(function(){i.fill(i.ready)},1)}var e=Zenosphere.helpers;t.type={},t.source={},t.prototype.poll=function(t){this.request("poll",t)},t.prototype.fill=function(t){var e=this;this.request(this.results.min?"refill":"fill",function(s){e.buffer=s,t()})},t.prototype.request=function(t,s){var i;t=t||"fill",i="string"==typeof this.options.action?this.options.action:this.options.action[t]||this.options.action.fill,this.options.paginate&&"poll"!==t&&this.vars.page++,this.get(e.template(i,this.vars),t,function(e){var i=this,n=[],o=this.getEvents(e);return o.length?(o.forEach(function(e){var s,o=i.getEventID(e);"poll"===t&&o<=i.results.max||"refill"===t&&o>=i.results.min||(s=i.getEventMessage(e))&&n.push({type:i.vars.type,date:i.getEventDate(e),message:s,link:i.getEventLink(e)})}),this.results.max&&"poll"!==t||(this.results.max=this.getEventID(o[0])),this.results.min&&"fill"!==t&&"refill"!==t||(this.results.min=this.getEventID(o[o.length-1])),void("function"==typeof s&&s(n))):s(n)})},t.prototype.current=function(){return this.buffer.length?this.buffer[0].date:0},t.prototype.shift=function(t){return this.buffer.length<=1&&(!this.options.paginate||this.options.paginate!==!0&&this.vars.page<this.options.paginate)?this.fill(this.shift.bind(this,t)):void(this.empty()||t(this.buffer.shift()))},t.prototype.empty=function(){return!this.buffer.length&&this.options.paginate&&this.options.paginate!==!0&&this.vars.page>=this.options.paginate},t.prototype._callback=function(t){var e="timeline_cb_"+Math.random().toString().substr(2),s=this;return window[e]=function(){t.apply(s,arguments),delete window[e]},e},t.prototype._params=function(t){var s=this,i="";return Object.keys(this.params).forEach(function(n){var o=s.params[n];"function"==typeof o&&(o=o.call(s,t)),void 0!==o&&(i+="&"+n+"="+e.template(o,s.vars))}),"?"+i.substr(1)},t.prototype.get=function(t,e,s){var i=this.options.url+t+this._params(3===arguments.length?e:"");if("undefined"==typeof s&&(s=e),"jsonp"===this.options.response){var n=document.createElement("script");n.src=i.replace(/([?&][^=]+=)\?(&|$)/,"$1"+this._callback(s)+"$2"),document.body.appendChild(n)}else{var o=new XMLHttpRequest;o.open("GET",i),o.send();var r=this;o.onreadystatechange=function(){4===o.readyState&&200===o.status&&s.call(r,"xml"===r.options.response?o.responseXML:JSON.parse(o.responseText))}}},Zenosphere.Stream=t}();
!function(){"use strict";var e=Zenosphere.helpers;Zenosphere.Stream.source.GitHub={icon:"github",options:{response:"json",paginate:2,url:"https://api.github.com/",action:"{stream}/events/public"},params:{page:function(e){return"poll"===e?1:"{page}"}},headers:{Accept:"applicatioin/vnd.github.v3+json"},getEvents:function(e){return e},getEventID:function(e){return parseInt(this.getEventDate(e),10)},getEventDate:function(t){return e.parseTime(t.created_at)},getEventMessage:function(t){var n="",a={};switch(t.type){case"PushEvent":n='Pushed {commits} commit{s} to <code>{ref}</code> on <a href="{repoUrl}" target="_blank">{repo}</a>',a={commits:t.payload.size,s:1===t.payload.size?"":"s",ref:t.payload.ref.replace(/^refs\/heads\//,""),repoUrl:"https://github.com/"+t.repo.name,repo:t.repo.name.replace(new RegExp("^"+t.actor.login+"/"),"")}}return n.length?e.template(n,a):void 0},getEventLink:function(e){switch(e.type){case"PushEvent":return"https://github.com/"+e.repo.name+"/compare/"+e.payload.before+"..."+e.payload.head}}}}();
!function(){"use strict";var e=Zenosphere.helpers;Zenosphere.Stream.source.Lastfm={icon:"music",options:{response:"xml",url:"https://ws.audioscrobbler.com/2.0/",action:"user/{stream}/recenttracks.rss"},params:{limit:200,from:function(e){return"poll"===e?this.results.max:void 0},to:function(e){return"refill"===e?this.results.min:void 0}},getEvents:function(t){return e.toArray(t.querySelectorAll("item"))},getEventID:function(e){return this.getEventDate(e)},getEventDate:function(t){return e.parseTime(t.querySelector("pubDate").innerHTML)},getEventMessage:function(e){return e.querySelector("title").innerHTML},getEventLink:function(e){return e.querySelector("link").innerHTML}}}();
!function(){"use strict";var e=Zenosphere.helpers;Zenosphere.Stream.source.Twitter={icon:"twitter",options:{response:"jsonp",url:"https://cdn.syndication.twimg.com/widgets/timelines/",action:{fill:"{stream}",poll:"paged/{stream}",refill:"paged/{stream}"}},params:{lang:"en",suppress_response_codes:"true",rnd:function(){return Math.random()},domain:location.host,callback:"?",since_id:function(e){return"poll"===e?this.results.max:void 0},max_id:function(e){return"refill"===e?this.results.min:void 0}},getEvents:function(t){var r=document.implementation.createHTMLDocument("twitter");return r.body.innerHTML=t.body,this.vars.user||(this.vars.user=this.getUser(r)),e.toArray(r.querySelectorAll(".tweet"))},getUser:function(e){var t=e.querySelector(".profile").href;return t.substr(t.lastIndexOf("/")+1)},getEventID:function(e){return parseInt(e.getAttribute("data-tweet-id"),10)},getEventDate:function(e){var t=parseInt(e.getAttribute("data-tweet-id"),10);return Math.floor((t/4194304+1288834974657)/1e3)},getEventMessage:function(t){var r=t.querySelector(".e-entry-title");e.toArray(r.querySelectorAll(".tco-hidden")).forEach(function(e){e.parentNode.removeChild(e)}),e.toArray(r.querySelectorAll("a")).forEach(function(e){var t=document.createElement("a");t.textContent=e.textContent,t.target="_blank",t.href=e.href,t.title=e.title,e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e)});var n=this.getUser(t);return r=r.innerHTML,n!==this.vars.user&&(r=e.template('RT <a href="https://twitter.com/{user}" target="_blank">@{user}</a>: {message}',{user:n,message:r})),r},getEventLink:function(e){return e.querySelector(".permalink").href}}}();